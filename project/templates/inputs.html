{% extends 'base.html' %} {% block pagestyles %}
<link rel="stylesheet" href="{{ url_for('static', filename='dist/css/forms.css') }}" rel="stylesheet" type="text/css">

<title> AXW Valuation Tool (BETA) </title>
{% endblock %} {% block content %}

<div class="row">

    <div class="col-sm col-sm">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h5 class="m-0 font-weight-bold text-primary">User Inputs for Valuation Engine</h5>
            </div>
            <div class="formwrapper">
                <form action='/valuation' method='POST' autocomplete="off">
                    {{ form.csrf_token }} {% with messages = get_flashed_messages(with_categories=true) %}
                    <div class="form-field_1">{{ form.ui_osoite.label}} {{form.ui_osoite(size=20)}} {% if messages %} {% for category, message in messages %} {% if category == 'street_err' or category == 'input_err'%}
                        <ul class=errors>
                            <li class="{{ category }}">{{ message }}</li>
                        </ul>
                        {% endif %} {% endfor %} {% endif %}
                    </div>
                    <div class="form-field_1">{{ form.ui_kunta.label}} {{form.ui_kunta}} {% if messages %} {% for category, message in messages %} {% if category == 'city_err'%}
                        <ul class=errors>
                            <li class="{{ category }}">{{ message }}</li>
                        </ul>
                        {% endif %} {% endfor %} {% endif %}
                    </div>
                    <div class="form-field_1">{{ form.ui_postinumero.label}} {{form.ui_postinumero}} {% if form.ui_postinumero.errors and form.ui_postinumero.data is not none %}
                        <ul class="errors">
                            {% for error in form.ui_postinumero.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    <div class="form-field_1">{{ form.ui_asuntotyyppi.label}} {{form.ui_asuntotyyppi}}</div>
                    <div class="form-field_1">{{ form.ui_kunto.label}} {{form.ui_kunto}}</div>
                    <div class="form-field_1">{{ form.ui_asuinala.label}} {{form.ui_asuinala}} {% if form.ui_asuinala.errors and form.ui_asuinala.data is not none %}
                        <ul class="errors">
                            {% for error in form.ui_asuinala.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    <div class="form-field_1">{{ form.ui_rakennusvuosi.label}} {{form.ui_rakennusvuosi}}</div>
                    <div class="form-field_1">{{ form.ui_huone_lkm.label}} {{form.ui_huone_lkm}}</div>
                    <div class="form-field_1">{{ form.ui_kerros.label}} {{form.ui_kerros}}</div>
                    <div class="form-field_1"></div>
                    <div class="form-field_1">{{ form.ui_kerros_yht.label}} {{form.ui_kerros_yht}}</div>
                    <div class="form-field_1">{{ form.ui_tontti.label}} {{form.ui_tontti}} {% if form.ui_tontti.errors and form.ui_tontti.data is not none %}
                        <ul class="errors">
                            {% for error in form.ui_tontti.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    <div class="form-field_1">{{ form.ui_vastike.label}} {{form.ui_vastike}} {% if form.ui_vastike.errors and form.ui_vastike.data is not none %}
                        <ul class="errors">
                            {% for error in form.ui_vastike.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    <div class="form-field_1">
                        <div class="form-field_2">{{ form.ui_hissi.label}} {{form.ui_hissi}}</div>
                        <div class="form-field_2">{{ form.ui_vuokrattu.label}} {{form.ui_vuokrattu}}</div>
                    </div>
                    <div class="form-field_1">
                        <div class="form-field_2">{{ form.ui_sauna.label}} {{form.ui_sauna}}</div>
                        <div class="form-field_2">{{ form.ui_parveke.label}} {{form.ui_parveke}}</div>
                    </div>
                    <div class="form-field_1">{{ form.ui_tonttiala.label}} {{form.ui_tonttiala}} {% if form.ui_tonttiala.errors and form.ui_tonttiala.data is not none %}
                        <ul class="errors">
                            {% for error in form.ui_tonttiala.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    <div class="form-field_1">{{ form.ui_muu_kerrosala.label}} {{form.ui_muu_kerrosala}} {% if form.ui_muu_kerrosala.errors and form.ui_muu_kerrosala.data is not none %}
                        <ul class="errors">
                            {% for error in form.ui_muu_kerrosala.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    <div class="submit-field">
                        <input id="submit" name="submit" type="submit" value="Laske" onclick="onReady();">
                    </div>
                </form>
                {% endwith %}
            </div>
        </div>
    </div>


    <link href="https://cdn.datatables.net/1.10.10/css/jquery.dataTables.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='dist/css/custom-datatables.css') }}" rel="stylesheet" type="text/css">
    <div class="col-xl-8 col-xl">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between ">
                <h5 class="m-0 font-weight-bold text-primary">Query History</h5>
            </div>
            <!-- Begin Page Content -->
            <div class="container-fluid" style="margin: 15px 30px 30px 0;">
                <!-- DataTales Example -->
                <div class="row">
                    <div class="col-lg-12">
                        <table id="tables" class="display" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Osoite</th>
                                    <th>Kunta</th>
                                    <th>Asuntotyyppi</th>
                                    <th>Asuinala</th>
                                    <th>Rakennusvuosi</th>
                                    <th>Kunto</th>
                                    <th>Unixtime</th>
                                    <th>Haettu</th>
                                    <th>Dummy</th>
                                    <th>Hinta</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="row"></div>



<!-- <div class="cssload-dots">
    <div class="cssload-dot"></div>
    <div class="cssload-dot"></div>
    <div class="cssload-dot"></div>
    <div class="cssload-dot"></div>
    <div class="cssload-dot"></div>
</div> -->
<!-- <svg version="1.1" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <filter id="goo">
        <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="12" ></feGaussianBlur>
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0	0 1 0 0 0	0 0 1 0 0	0 0 0 18 -7" result="goo" ></feColorMatrix>
      </filter>
    </defs>
  </svg> -->



{% endblock %} {% block additionalscripts %}
<script src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js"></script>
<script src="//cdn.datatables.net/plug-ins/1.10.20/sorting/datetime-moment.js"></script>
<script type="text/javascript" charset="utf-8">
    function format(d) {
        // `d` is the original data object for the row
        return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' +
            '<tr>' +
            '<td>Lis채tieto1:</td>' +
            '<td>' + d[1] + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>Lis채tieto2:</td>' +
            '<td>' + d[2] + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>Extra info:</td>' +
            '<td>Linkki, kuva tms. t채h채n</td>' +
            '</tr>' +
            '</table>';
    }




    $(document).ready(function() {

        $.fn.dataTable.moment('dd.MM.YYYY HH:mm');

        var table = $('#tables').DataTable({
            "processing": true,
            "serverSide": true,
            "ajax": "{{ url_for('valuation_bp.data') }}",
            'scrollX': true,
            "lengthMenu": [
                [15, 25, 50, -1],
                [15, 25, 50, "All"]
            ],
            "columnDefs": [{
                'orderData': [6],
                'targets': [7]

            }, {
                "targets": [7, 9],
                "visible": false,
                "searchable": false
            }, {
                "targets": [6, 7, 8],
                "type": "num"
            }],
            "order": [
                [7, "desc"]
            ],
            'columns': [{
                "className": 'details-control',
                "orderable": false,
                "data": null,
                "defaultContent": ''
            }, {
                'data': '0'

            }, {
                'data': '1'

            }, {
                'data': '2'

            }, {
                'data': '3'

            }, {
                'data': '4'

            }, {
                'data': '5'

            }, {
                'data': '6'

            }, {
                'data': '7'

            }, {
                'data': '8'

            }, {
                'data': '9',
                render: function(data, type, row) {
                    if (data !== 'Hakuvirhe') {
                        var abbr = "EUR";

                        var symbol = "";
                        if (abbr == "USD") {
                            symbol = "$";

                        } else if (abbr == "GBP") {
                            symbol = "&pound;";

                        } else if (abbr == "EUR") {
                            symbol = "&euro;";
                        }

                        var num = $.fn.dataTable.render.number(' ', '.', 0).display(data);
                        return num + ' ' + abbr;
                    } else {
                        return data;
                    }
                }
            }]

        });


        // Add event listener for opening and closing details
        $('#tables tbody').on('click', 'td.details-control', function() {
            var tr = $(this).closest('tr');
            var row = table.row(tr);

            if (row.child.isShown()) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('shown');
            } else {
                // Open this row
                row.child(format(row.data())).show();
                tr.addClass('shown');
            }
        });
    });
</script>

<script>
    function onReady(callback) {
        var intervalId = window.setInterval(function() {
            if (document.getElementsByTagName('body')[0] !== undefined) {
                window.clearInterval(intervalId);
                callback.call(this);
            }
        }, 1000);
    }

    function setVisible(selector, visible) {
        document.querySelector(selector).style.display = visible ? 'block' : 'none';
    }

    onReady(function() {
        setVisible('.form', true);
        setVisible('#cssload-dots', false);
    });
</script>

{% endblock %}